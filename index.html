<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SnapSat</title>
  <style>
    /* Basic Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    /* Header Style */
    header {
      width: 100%;
      background-color: #fff;
      text-align: center;
      padding: 40px 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    header .tagline {
      font-size: 1.3rem;
      color: #555;
    }

    /* Chat Container */
    #chat-container {
      width: 80%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 5px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
      min-height: 60px; /* for visual stability */
    }

    /* Typing text */
    #typing {
      font-size: 1.1rem;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    /* Chat Image */
    #chatImage {
      width: 80%;
      max-width: 600px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 20px;
      transition: opacity 1.5s ease;
      opacity: 0;            /* hidden initially */
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #chatImage.visible {
      opacity: 1;           /* fade in */
    }
    #chatImage.fadingOut {
      opacity: 0;           /* fade out */
    }

    /* Explanation box */
    #explanation {
      width: 80%;
      max-width: 600px;
      background-color: #fff;
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-style: italic;
      margin: 20px auto 0;
      transition: opacity 1.5s ease;
      opacity: 0;           /* hidden initially */
    }
    #explanation.visible {
      opacity: 1;           /* fade in */
    }
    #explanation.fadingOut {
      opacity: 0;           /* fade out */
    }
  </style>
</head>
<body>

  <!-- Header with Title & Tagline -->
  <header>
    <h1>SnapSat</h1>
    <div class="tagline">the easiest way to have a look</div>
  </header>

  <!-- Single Chat Box Container -->
  <div id="chat-container">
    <div id="typing"></div>
  </div>

  <!-- Single Image & Explanation for All Scenes -->
  <!-- Update "satellite.jpg" / "ndvi.jpg" paths if they are in a folder like "images/" -->
  <img id="chatImage" src="" alt="Chat Image" />
  <div id="explanation"></div>

  <script>
    // Scenes data
    const scenes = [
      {
        userText: "I want to buy a house, can you give me the site history?",
        imageSrc: "satellite.jpg", // or "images/satellite.jpg"
        explanation: "The site was a forest until conversion in 2018. It currently looks like agricultural land."
      },
      {
        userText: "I am buying products from this farm, can you check the health?",
        imageSrc: "ndvi.jpg", // or "images/ndvi.jpg"
        explanation: "I accessed Sentinel-2 data and applied a vegetation index. The photosynthetic activity is lower than expected. Should I inspect for an anomaly?"
      },
      {
        userText: "Yes, show me the trend and detect anomalies",
        imageSrc: "ndvi.jpg", // same or second NDVI image
        explanation: "There is a significant departure from previous seasonal trends. It appears that bare soil is exposed, indicating a harvest or crop rotation."
      }
    ];

    // HTML elements
    const typingEl = document.getElementById("typing");
    const chatImageEl = document.getElementById("chatImage");
    const explanationEl = document.getElementById("explanation");

    // Configuration
    const typingSpeed = 50;      // ms per character
    const pauseBetweenScenes = 3000; // ms to wait after finishing a scene before next

    let currentScene = 0;

    // Type text character by character
    function typeText(element, text, speed, callback) {
      let i = 0;
      element.textContent = ""; // Clear previous text
      function typing() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(typing, speed);
        } else if (callback) {
          callback();
        }
      }
      typing();
    }

    function fadeOutImageAndExplanation(fadeDuration = 1500) {
      // Fade out image and explanation
      chatImageEl.classList.remove("visible");
      chatImageEl.classList.add("fadingOut");
      explanationEl.classList.remove("visible");
      explanationEl.classList.add("fadingOut");

      // Return a promise that resolves after fadeDuration
      return new Promise((resolve) => {
        setTimeout(() => {
          // Reset them to be ready for next scene
          chatImageEl.classList.remove("fadingOut");
          explanationEl.classList.remove("fadingOut");
          // Hide them fully for now
          chatImageEl.style.opacity = 0;
          explanationEl.style.opacity = 0;
          resolve();
        }, fadeDuration);
      });
    }

    function showScene(sceneIndex) {
      if (sceneIndex >= scenes.length) {
        return; // No more scenes
      }
      const { userText, imageSrc, explanation } = scenes[sceneIndex];

      // 1) Fade out old image & explanation
      fadeOutImageAndExplanation().then(() => {
        // 2) Type the new user text
        typeText(typingEl, userText, typingSpeed, () => {
          // 3) After typing is done, fade in the new image and explanation
          chatImageEl.src = imageSrc;
          chatImageEl.classList.add("visible");
          explanationEl.textContent = explanation;
          explanationEl.classList.add("visible");

          // 4) Wait some time, then move to the next scene
          setTimeout(() => {
            currentScene++;
            showScene(currentScene);
          }, pauseBetweenScenes);
        });
      });
    }

    // Start from scene 0
    showScene(currentScene);
  </script>
</body>
</html>
