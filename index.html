<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SnapSat</title>
  <!-- Link the external stylesheet -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Header with Title & Tagline -->
  <header>
    <h1>SnapSat</h1>
    <div class="tagline">The easiest way to take a look.</div>
  </header>

  <!-- Single Chat Box Container -->
  <div id="chat-container">
    <div id="typing"></div>
  </div>

  <!-- Single Image & Explanation for All Scenes -->
  <!-- If your images are in a subfolder, e.g. "images/", use imageSrc: "images/satellite.jpg" below. -->
  <img id="chatImage" src="" alt="Chat Image" />
  <div id="explanation"></div>

  <script>
    // Scenes data
    const scenes = [
      {
        userText: "I want to buy a house, can you give me the site history?",
        imageSrc: "satellite.jpg",
        explanation: "The site was a forest until conversion in 2018. It currently looks like agricultural land."
      },
      {
        userText: "I am buying products from this farm, can you check the health?",
        imageSrc: "ndvi.jpg",
        explanation: "I accessed Sentinel-2 data and applied a vegetation index. The photosynthetic activity is lower than expected. Should I inspect for an anomaly?"
      },
      {
        userText: "Yes, show me the trend and detect anomalies",
        imageSrc: "ndvi.jpg",
        explanation: "There is a significant departure from previous seasonal trends. It appears that bare soil is exposed, indicating a harvest or crop rotation."
      }
    ];

    const typingEl = document.getElementById("typing");
    const chatImageEl = document.getElementById("chatImage");
    const explanationEl = document.getElementById("explanation");

    const typingSpeed = 50;          // ms per character
    const pauseBetweenScenes = 3000; // ms to wait after finishing a scene

    let currentScene = 0;

    // Type text character by character
    function typeText(element, text, speed, callback) {
      let i = 0;
      element.textContent = "";
      function typing() {
        if (i < text.length) {
          element.textContent += text.charAt(i);
          i++;
          setTimeout(typing, speed);
        } else if (callback) {
          callback();
        }
      }
      typing();
    }

    // Fade out image and explanation
    function fadeOutImageAndExplanation(fadeDuration = 1500) {
      chatImageEl.classList.remove("visible");
      chatImageEl.classList.add("fadingOut");
      explanationEl.classList.remove("visible");
      explanationEl.classList.add("fadingOut");

      return new Promise((resolve) => {
        setTimeout(() => {
          // Reset states after fade
          chatImageEl.classList.remove("fadingOut");
          explanationEl.classList.remove("fadingOut");
          resolve();
        }, fadeDuration);
      });
    }

    // Show each scene in sequence
    function showScene(sceneIndex) {
      if (sceneIndex >= scenes.length) return;

      const { userText, imageSrc, explanation } = scenes[sceneIndex];

      // 1) Fade out old image & explanation
      fadeOutImageAndExplanation().then(() => {
        // 2) Type the new user text
        typeText(typingEl, userText, typingSpeed, () => {
          // 3) After typing is done, fade in the new image and explanation
          chatImageEl.src = imageSrc;
          chatImageEl.classList.add("visible");

          explanationEl.textContent = explanation;
          explanationEl.classList.add("visible");

          // 4) Wait, then move to the next scene
          setTimeout(() => {
            currentScene++;
            showScene(currentScene);
          }, pauseBetweenScenes);
        });
      });
    }

    // Start from scene 0
    showScene(currentScene);
  </script>
</body>
</html>
